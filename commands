git clone --recurse-submodules git@github.com:ethayu/diffusion-trait-steering.git
cd dsrl

conda create -n dsrl python=3.9 -y
conda activate dsrl

cd dppo
pip install -e .
pip install -e .[gym]

# Fix egl-probe CMake compatibility issue before installing robomimic
# egl-probe requires CMake < 3.5, but newer CMake versions don't support that
# Download, patch, and install egl-probe manually:
cd /tmp
pip download --no-binary egl-probe egl-probe
tar -xzf egl_probe-*.tar.gz
cd egl_probe-*
# Patch CMakeLists.txt to require CMake 3.5 instead of 2.8.12
sed -i 's/cmake_minimum_required(VERSION 2.8.12)/cmake_minimum_required(VERSION 3.5)/' egl_probe/CMakeLists.txt
pip install .
cd ~/proj/diffusion-trait-steering/dppo

pip install -e .[robomimic]
cd ..

cd stable-baselines3
pip install -e .
cd ..

next download mujoco (its going to expect mujoco to be in your home dir)
mkdir -p ~/.mujoco
cd ~/.mujoco
wget https://mujoco.org/download/mujoco210-linux-x86_64.tar.gz
tar -xzf mujoco210-linux-x86_64.tar.gz

if you do it right you should see this after the command ls ~/.mujoco/mujoco210
bin  include  model  sample  THIRD_PARTY_NOTICES

then in the conda env,
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/.mujoco/mujoco210/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/nvidia

and fix numpy version:
pip install "numpy<2.0"

install d4rl (requires specific setup):
# Install cmake and other build dependencies
conda install -y cmake
conda install -y -c conda-forge glew patchelf

# Install mujoco 3.x (for dm-control dependency) - use pre-built wheel to avoid build issues
pip install "mujoco>=3.3.6,<3.4.0" --only-binary=mujoco

# Downgrade Cython to version compatible with mujoco_py
pip install "cython<3.0"

# Install d4rl
pip install d4rl

# Set environment variables (add to ~/.bashrc for persistence)
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/.mujoco/mujoco210/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/nvidia

I put the pretrained hopper checkpoint here: 
I see, it seems that any changes made to dppo wont be saved.
Maybe we can think about making a fork of the dppo repo and make the changes there.

but for now you can download the folder with the pretrained weights here:
https://drive.google.com/drive/folders/15W-1Exgl_vSGbgkVEIBoC1PwKGtIbMA7

then put the unzipped folder here:
diffusion-trait-steering/dppo/log

on my end it is here and the only file in the folder is here.
diffusion-trait-steering/dppo/log/gym-pretrain/hopper-medium-v2_pre_diffusion_mlp_ta4_td20/2024-06-12_23-10-05/checkpoint/state_3000.pt

CUDA_VISIBLE_DEVICES=2 python train_dsrl.py --config-path=cfg/gym --config-name=dsrl_walker.yaml

CUDA_VISIBLE_DEVICES=2 python train_dsrl.py --config-path=cfg/gym --config-name=dsrl_walker_stride_v3.yaml

CUDA_VISIBLE_DEVICES=2 python record_walker_rollouts.py   model_path=/home/asethi04/proj/diffusion-trait-steering/logs/gym-dsrl/gym_walker_dsrl_2025-12-24_04-48-08_1/2025-12-24_04-48-08_1/checkpoint/ft_policy_80000_steps.zip   record_episodes=4


CUDA_VISIBLE_DEVICES=4 python record_walker_gap_max.py record_episodes=4 video_dir=jan112026 save_first_last=2 model_path=/home/asethi04/proj/diffusion-trait-steering/logs/gym-dsrl/gym_walker_dsrl_gap_max_2026-01-11_22-38-17_1/2026-01-11_22-38-17_1/checkpoint/ft_policy_120000_steps.zip 

CUDA_VISIBLE_DEVICES=4 python record_walker_stride_v3.py \
    model_path=/home/asethi04/proj/diffusion-trait-steering/logs/gym-dsrl/gym_walker_dsrl_stride_v3_2026-01-13_20-01-41_1/2026-01-13_20-01-41_1/checkpoint/ft_policy_8000_steps.zip\
    record_episodes=4 \
    video_dir=nomins8k

